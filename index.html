<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />

  <!-- âœ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Slot Game - White Spin Wheel</title>

  <style>
    /* Ø®Ø·ÙˆØ· */
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&family=Orbitron:wght@500;700&display=swap');

    :root{
      /* Ø­Ø¬Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø© (Ø¨Ø¯ÙŠÙ„ 200px) â€” ÙŠØ¶Ø¨Ø·Ù‡ JS Ø­Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© */
      --tile: 18vmin;                 /* Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙ‚Ø· */
      /* Ø²Ø± Ø§Ù„Ø³Ø¨Ù† */
      --spin-size: clamp(56px, 12vmin, 110px);
      --spin-gap: 2vmin;

      /* Ø£Ù„ÙˆØ§Ù† ÙˆØ¥Ø·Ø§Ø±Ø§Øª */
      --gold-dk:#7a4f02; --gold:#e3b653; --gold-hi:#ffe69a;
      --burgundy-1:#2b0715; --burgundy-2:#4a0b22; --burgundy-3:#6e1030;
      --grid-gold:rgba(255,215,120,.35); --grid-gold-soft:rgba(255,215,120,.22);
      --hud-stroke:rgba(255,215,120,.58);
      --led-amber:#ffd66d;

      /* Ø£Ø¨Ø¹Ø§Ø¯ Ù…Ø´ØªÙ‚Ø© Ù…Ù† Ø§Ù„Ø¨Ù„Ø§Ø·Ø© (5 Ø£Ø¹Ù…Ø¯Ø© Ã— 3 ØµÙÙˆÙ) */
      --slot-w: calc(var(--tile) * 5);
      --slot-h: calc(var(--tile) * 3);

      /* Ø­Ø´Ùˆ/Ø§Ù†Ø­Ù†Ø§Ø¡Ø§Øª Ù…Ø±Ù†Ø© */
      --radius-lg: clamp(12px, 2.2vmin, 24px);
      --radius-md: clamp(10px, 1.8vmin, 16px);
      --inset: clamp(8px, 1.2vmin, 12px);
    }

    /* RESET */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      min-height:100vh;
      display:flex;flex-direction:column;align-items:center;
      padding:clamp(10px, 2vmin, 24px);
      color:#fff;
      background:url("images/background.png") no-repeat center center fixed;
      background-size:cover;
      overflow-x:hidden;
    }
    body::before{
      content:"";position:absolute;inset:0;pointer-events:none;z-index:-1;opacity:.28;
      background: radial-gradient(1200px 520px at 50% 100%, rgba(255,215,0,.10), transparent 70%),
                  radial-gradient(1000px 400px at 50% 0%, rgba(255,215,0,.08), transparent 72%);
    }

    /* Ø¥Ø·Ø§Ø± Ø¹Ø§Ù… ÙŠØªÙ…Ø¯Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ù…Ø­ØªÙˆØ§Ù‡ */
    .machine-frame{
      display:inline-flex;justify-content:center;align-items:center;
      padding:clamp(12px,2.4vmin,28px);
      border-radius: var(--radius-lg);
      background:
        radial-gradient(1200px 800px at 50% 50%, rgba(255,190,60,.06), transparent 60%),
        radial-gradient(circle at 50% 40%, var(--burgundy-3) 0%, var(--burgundy-2) 55%, var(--burgundy-1) 100%);
      box-shadow: 0 3vmin 8vmin rgba(0,0,0,.65),
                  inset 0 0 0 .2vmin rgba(255,215,0,.16),
                  0 0 4vmin rgba(255,215,0,.16);
    }

    /* Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©: ØªØ¹ØªÙ…Ø¯ ÙƒÙ„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ --tile */
    .slot-container{
      width: var(--slot-w);
      height: var(--slot-h);
      position:relative;overflow:hidden;
      border-radius: var(--radius-md);
      box-shadow: 0 0 0 .12vmin rgba(0,0,0,.35) inset, 0 0 0 1vmin rgba(0,0,0,.25) inset;
    }
    .slot-container::before{
      content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;z-index:2;
      box-shadow:
        inset 0 0 0 .6vmin var(--gold-dk),
        inset 0 0 0 .9vmin var(--gold),
        inset 0 0 0 1.2vmin var(--gold-dk),
        inset 0 0 4vmin rgba(255,215,0,.22);
    }
    .slot-container::after{
      content:"";position:absolute;inset: var(--inset);border-radius:calc(var(--radius-md) - .4vmin);pointer-events:none;z-index:1;
      background:
        repeating-linear-gradient(to right, var(--grid-gold) 0, var(--grid-gold) .35vmin, transparent .35vmin, transparent calc(var(--tile))),
        repeating-linear-gradient(to bottom, var(--grid-gold-soft) 0, var(--grid-gold-soft) .25vmin, transparent .25vmin, transparent calc(var(--tile)));
      box-shadow: inset 0 0 3vmin rgba(0,0,0,.35), inset 0 1vmin 3vmin rgba(0,0,0,.35);
    }

    /* Ø§Ù„Ø¨ÙƒØ±Ø§Øª */
    .reels{display:flex;width:100%;height:100%}
    .reel{flex:1;overflow:hidden;position:relative}
    .reel:not(:first-child)::before{
      content:"";position:absolute;top:var(--inset);bottom:var(--inset);left:-.2vmin;width:.5vmin;border-radius:.4vmin;z-index:2;
      background:linear-gradient(180deg, var(--gold-hi), var(--gold) 50%, var(--gold-dk));
      box-shadow:0 0 1.2vmin rgba(255,215,0,.25), inset 0 0 .4vmin rgba(0,0,0,.35);
      pointer-events:none;
    }
    .reel-inner{position:relative;width:100%;will-change:transform}

    /* Ø§Ù„Ø¨Ù„Ø§Ø·Ø© */
    .symbol{
      width: var(--tile);
      height: var(--tile);
      position:absolute;left:50%;transform:translateX(-50%);
    }
    .symbol-img{
      width:100%;height:100%;
      background-size: var(--tile) var(--tile);
      background-position:center;background-repeat:no-repeat;
      image-rendering:-webkit-optimize-contrast;
    }

    /* ÙÙ„Ø§Ø´ Ø§Ù„ÙÙˆØ² */
    .symbol-img.win-flash{position:relative;animation:superFlash 2.5s infinite ease-in-out;z-index:3}
    @keyframes superFlash{
      0%{transform:scale(1);filter:hue-rotate(0deg)}
      25%{transform:scale(1.08);filter:hue-rotate(90deg)}
      50%{transform:scale(1);filter:hue-rotate(180deg)}
      75%{transform:scale(1.08);filter:hue-rotate(270deg)}
      100%{transform:scale(1);filter:hue-rotate(360deg)}
    }

    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù†Ø²ÙˆÙ„ Ø§Ù„Ø¨ÙƒØ±Ø§Øª â€” Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ± Ø§Ù„Ø¨Ù„Ø§Ø·Ø© Ø¨Ø¯Ù„ px */
    @keyframes spinDown{
      /* ÙƒØ§Ù†Øª 4200/3800/2700/2450/2360/2400 px Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ 200px */
      0%   { transform: translateY(calc(var(--tile) * -21)); }
      10%  { transform: translateY(calc(var(--tile) * -19)); }
      70%  { transform: translateY(calc(var(--tile) * -13.5)); }
      88%  { transform: translateY(calc(var(--tile) * -12.25)); }
      94%  { transform: translateY(calc(var(--tile) * -11.8)); }
      100% { transform: translateY(calc(var(--tile) * -12)); }
    }

    /* ===== ØµÙ Ø§Ù„Ø³Ø¨Ù† ØªØ­Øª Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© ===== */
    .spin-row{
      width:100%;display:flex;justify-content:center;margin-top:var(--spin-gap);
    }
    .spin-row-inner{
      width: var(--slot-w);
      display:flex;align-items:center;justify-content:flex-start;gap:1.5vmin;flex-wrap:wrap;
    }

    #spinBtn{
      width:var(--spin-size); height:var(--spin-size);
      background:none;border:none;cursor:pointer;outline:none;padding:0;
      filter:drop-shadow(0 0 .6vmin rgba(0,0,0,.5));
      touch-action:manipulation;
    }
    #spinBtn img{
      width:100%;height:100%;display:block;object-fit:contain;
      animation:wheelMotion 3s infinite linear;
      filter:drop-shadow(0 0 1vmin rgba(255,255,255,.85));
    }
    #spinBtn:active img{animation-play-state:paused;transform:scale(.86)}
    @keyframes wheelMotion{0%{transform:rotate(0)}50%{transform:rotate(180deg)}100%{transform:rotate(360deg)}}

    /* Ù„ÙˆØ­Ø© Ø§Ù„ÙƒÙ„ÙƒØ§Øª */
    .controls{display:flex;gap:1.2vmin;align-items:center;flex-wrap:wrap}
    .info-panel{display:flex;gap:1.2vmin;flex-wrap:wrap;align-items:center}
    .info{
      padding:clamp(8px,1.2vmin,12px) clamp(10px,1.6vmin,14px);
      border-radius: clamp(8px, 1.2vmin, 12px);
      position:relative;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)),
                 linear-gradient(180deg,#13171d,#0a0d11 60%,#07090c);
      border:.18vmin solid var(--hud-stroke);
      box-shadow: inset 0 .1vmin 0 rgba(255,255,255,.12), inset 0 0 3vmin rgba(255,215,120,.08), 0 .3vmin 1vmin rgba(0,0,0,.35);
      display:flex;align-items:center;gap:.8vmin
    }
    .info label{
      font: 800 clamp(11px, 1.6vmin, 13px)/1 "Cairo",system-ui,sans-serif;
      color:var(--gold-hi);background-image:linear-gradient(180deg,#fff2b8,#e8be6a 55%,#7a4f02);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;
      text-shadow:0 0 .3vmin rgba(255,255,255,.35),0 .2vmin .1vmin rgba(0,0,0,.55);
    }
    #credits,#lastWin,#betPerLine,#linesCount{
      font-family:"Orbitron",system-ui,sans-serif;font-weight:700;letter-spacing:.5px;
      font-size: clamp(16px, 2.2vmin, 20px);
      color:var(--led-amber);text-shadow:0 0 .6vmin rgba(255,178,0,.75),0 .1vmin 0 #2a1500
    }
    #credits,#lastWin{
      min-width: clamp(72px, 11vmin, 120px);
      text-align:center;padding:.6vmin 1vmin;border-radius:1vmin;border:.18vmin solid rgba(255,178,0,.45);
      background: linear-gradient(180deg,#0c1016,#06080c 65%,#04070a);
    }
    select,input[type="number"]{
      width: clamp(72px, 12vmin, 120px);
      height: clamp(40px, 7vmin, 54px);          /* âœ… Ù‚ÙŠØ§Ø³ Ù„Ù…Ø³ Ù…Ø±ÙŠØ­ */
      padding: .8vmin 1vmin;border-radius:1vmin;border:.18vmin solid rgba(255,178,0,.4);
      background: linear-gradient(180deg,#11161d,#0b0f15 60%,#090d13);
      color:var(--led-amber);outline:none;
      -webkit-tap-highlight-color: transparent;
    }
    select:focus,input[type="number"]:focus{box-shadow:0 0 0 .6vmin rgba(255,199,75,.22)}

    .audio-icon{
      font-size: clamp(20px, 3.6vmin, 24px);
      width: clamp(40px, 7vmin, 52px);
      height: clamp(40px, 7vmin, 52px);
      border-radius:50%;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg,#1e252d,#0b0f15);
      border:.18vmin solid var(--hud-stroke);
      box-shadow: 0 .8vmin 2vmin rgba(0,0,0,.35), inset 0 0 3vmin rgba(255,215,120,.08);
      cursor:pointer;user-select:none;
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØª */
    .audio-panel{
      position:fixed;top: 2vmin; right: 2vmin;
      width: clamp(220px, 40vmin, 280px);
      background:#222;border:1px solid #444;border-radius:1.2vmin;padding:1.2vmin;display:none;z-index:99999
    }
    .audio-panel h3{margin-bottom:1vmin;text-align:center}
    .sound-control{display:flex;flex-direction:column;margin-bottom:1.2vmin}
    .sound-control label{margin-bottom:.6vmin;font-size: clamp(12px, 1.8vmin, 14px);font-weight:bold}
    .sound-control input[type="range"]{width:100%}
    .mute-row{display:flex;align-items:center;justify-content:space-between}

    /* ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù‚Ø¯Ù‘Ù…Ø© */
    .intro-overlay{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:1000000}
    .intro-overlay video{width:100vw;height:100vh;object-fit:contain;background:#000}

    /* ===== Media Queries ===== */
    /* Ø´Ø§Ø´Ø§Øª ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
    @media (max-width: 600px){
      .spin-row-inner{flex-direction:column;align-items:center;gap:2.2vmin;}
      .controls{width:100%;justify-content:center;}
      .info-panel{justify-content:center;}
      :root{ --spin-size: clamp(64px, 16vmin, 96px); }
    }

    /* Ø´Ø§Ø´Ø§Øª ÙƒØ¨ÙŠØ±Ø© */
    @media (min-width: 1200px){
      :root{ --spin-size: clamp(80px, 10vmin, 120px); }
      .machine-frame{padding:clamp(16px,2.8vmin,36px)}
    }
  </style>
</head>
<body dir="rtl">

  <!-- ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù‚Ø¯Ù‘Ù…Ø© (Ù„Ø§ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚) -->
  <div id="introOverlay" class="intro-overlay">
    <video id="introVideo" src="aa.mp4" preload="auto" autoplay muted playsinline webkit-playsinline></video>
  </div>

  <div class="machine-frame">
    <div class="slot-container">
      <div class="reels" id="reels"><!-- ØªÙØ¨Ù†Ù‰ Ø¨Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª --></div>
    </div>
  </div>

  <!-- ØµÙ Ø§Ù„Ø³Ø¨Ù† ØªØ­Øª Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© -->
  <div class="spin-row">
    <div class="spin-row-inner">
      <button id="spinBtn" aria-label="Spin"><img src="images/spin.png" alt="Spin" /></button>

      <div class="controls">
        <div class="info-panel">
          <div class="info">
            <label for="linesCount">Lines:</label>
            <select id="linesCount">
              <option value="1" selected>1</option>
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
            </select>
          </div>
          <div class="info">
            <label for="betPerLine">Bet/Line:</label>
            <input type="number" id="betPerLine" value="1" min="1" />
          </div>
          <div class="info">
            <label>Credits:</label>
            <span id="credits">1000</span>
          </div>
          <div class="info">
            <label>Last Win:</label>
            <span id="lastWin">0</span>
          </div>
        </div>
        <div class="audio-icon" id="audioIcon">ğŸ”Š</div>
      </div>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØª -->
  <div class="audio-panel" id="audioPanel">
    <h3>Sound Settings</h3>
    <div class="sound-control">
      <label>Music</label>
      <input type="range" min="0" max="1" step="0.01" value="1" data-sound="music" class="volume-slider" />
      <div class="mute-row"><span>Mute</span><input type="checkbox" data-mute="music" /></div>
    </div>
    <div class="sound-control">
      <label>Spin</label>
      <input type="range" min="0" max="1" step="0.01" value="1" data-sound="spin" class="volume-slider" />
      <div class="mute-row"><span>Mute</span><input type="checkbox" data-mute="spin" /></div>
    </div>
    <div class="sound-control">
      <label>Reels</label>
      <input type="range" min="0" max="1" step="0.01" value="1" data-sound="dd" class="volume-slider" />
      <div class="mute-row"><span>Mute</span><input type="checkbox" data-mute="dd" /></div>
    </div>
    <div class="sound-control">
      <label>Win</label>
      <input type="range" min="0" max="1" step="0.01" value="1" data-sound="win" class="volume-slider" />
      <div class="mute-row"><span>Mute</span><input type="checkbox" data-mute="win" /></div>
    </div>
    <div class="sound-control">
      <label>Bonus</label>
      <input type="range" min="0" max="1" step="0.01" value="1" data-sound="bonus" class="volume-slider" />
      <div class="mute-row"><span>Mute</span><input type="checkbox" data-mute="bonus" /></div>
    </div>
  </div>

  <script>
    /* ============================================================
       âš™ï¸ Ø§Ù„ØµÙˆØª/Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© â€” Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†/Ø§Ù„Ù…Ù†Ø·Ù‚
    ============================================================ */
    let freeSpins = 0;
    let isBonusActive = false;

    const musicSound = new Audio("sounds/music.mp3"); musicSound.loop = true; musicSound.muted = true;
    const spinSound  = new Audio("sounds/spin.mp3");
    const ddSound    = new Audio("sounds/dd.mp3");
    const winSound   = new Audio("sounds/win.mp3");
    const bonusSound = new Audio("sounds/bonus.mp3");
    const crashSound = new Audio("sounds/crash.mp3"); crashSound.loop = true;

    const soundsMap = { music:musicSound, spin:spinSound, dd:ddSound, win:winSound, bonus:bonusSound, crash:crashSound };

    window.addEventListener("load", () => {
      musicSound.play().catch(() => {
        document.addEventListener("click", function onceClick(){
          musicSound.play().catch(()=>{});
          document.removeEventListener("click", onceClick);
        });
      });
    });

    /* Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØª */
    (function setupAudioPanel(){
      const audioIcon=document.getElementById("audioIcon");
      const audioPanel=document.getElementById("audioPanel");
      let open=false;
      function show(){audioPanel.style.display="block";open=true;}
      function hide(){audioPanel.style.display="none";open=false;}
      audioIcon.addEventListener("click",(e)=>{e.stopPropagation();open?hide():show();});
      document.addEventListener("click",(e)=>{ if(!open) return; if(!audioPanel.contains(e.target) && e.target!==audioIcon) hide();});
      audioPanel.addEventListener("click",(e)=>e.stopPropagation());
      document.addEventListener("keydown",(e)=>{if(e.key==="Escape" && open) hide();});
      document.querySelectorAll(".volume-slider").forEach(sl=>{
        sl.addEventListener("input",(e)=>{const k=e.target.dataset.sound;const v=parseFloat(e.target.value); if(soundsMap[k]) soundsMap[k].volume = isFinite(v) ? v : 1;});
      });
      document.querySelectorAll("input[type='checkbox'][data-mute]").forEach(ch=>{
        ch.addEventListener("change",(e)=>{const k=e.target.dataset.mute; if(soundsMap[k]) soundsMap[k].muted=!!e.target.checked;});
      });
    })();

    /* ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù‚Ø¯Ù‘Ù…Ø© */
    (function setupIntroVideo(){
      const overlay=document.getElementById("introOverlay");
      const video=document.getElementById("introVideo");
      if(!overlay||!video) return;
      video.muted=true; video.setAttribute('playsinline',''); video.setAttribute('webkit-playsinline',''); video.autoplay=true;

      window.addEventListener("load",()=>{
        try{ musicSound.pause(); }catch(e){}
        const p=video.play();
        if(p && typeof p.catch==="function"){
          p.catch(()=>{
            const tap=()=>{ video.play().catch(()=>{}); overlay.removeEventListener("click", tap); };
            overlay.addEventListener("click", tap);
          });
        }
      });
      video.addEventListener("ended",()=>{
        overlay.style.display="none";
        try{ musicSound.muted=false; musicSound.currentTime=0; musicSound.play().catch(()=>{}); }catch(e){}
      },{once:true});
    })();

    /* Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© */
    function toInt(v,d){const n=parseInt(v,10);return Number.isFinite(n)?n:d;}
    function clamp(n,min,max){return Math.min(max,Math.max(min,n));}
    function fixNumber(n,def=0){n=Number(n);return Number.isFinite(n)?n:def;}

    /* Ø§Ù„Ø±Ù…ÙˆØ² / Ø§Ù„ØµÙˆØ± */
    function getSymbolBackground(symUrl){return `url("${symUrl}"), url("images/d1.png")`;}
    const symbolsArr=[
      {name:"d1",url:"images/d1.png"},{name:"d2",url:"images/d2.png"},
      {name:"d3",url:"images/d3.png"},{name:"d4",url:"images/d4.png"},
      {name:"d5",url:"images/d5.png"},{name:"d6",url:"images/d6.png"},
      {name:"d7",url:"images/d7.png"},{name:"d8",url:"images/d8.png"},
      {name:"wild",url:"images/wild.png"},{name:"scatter",url:"images/scatter.png"},
      {name:"bonus",url:"images/bonus.png"}
    ];
    function symbolByName(n){return symbolsArr.find(s=>s.name===n);}

    /* Ø´Ø±Ø§Ø¦Ø· Ø§Ù„Ø¨ÙƒØ±Ø§Øª (Ù„Ø§ ØªØºÙŠÙŠØ±) */
    function buildStrip(counts){
      const arr=[]; for(const [name,cnt] of Object.entries(counts)){for(let i=0;i<cnt;i++) arr.push(name);}
      for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];}
      return arr;
    }
    const REEL_STRIPS_NAMES=[
      buildStrip({d1:24,d2:20,d3:16,d4:13,d5:8,d6:5,d7:2,d8:1,wild:1,scatter:1,bonus:1}),
      buildStrip({d1:23,d2:20,d3:16,d4:13,d5:8,d6:5,d7:2,d8:1,wild:1,scatter:1,bonus:1}),
      buildStrip({d1:22,d2:19,d3:16,d4:13,d5:8,d6:5,d7:2,d8:1,wild:1,scatter:1,bonus:1}),
      buildStrip({d1:21,d2:19,d3:16,d4:12,d5:8,d6:5,d7:2,d8:1,wild:1,scatter:1,bonus:1}),
      buildStrip({d1:20,d2:18,d3:16,d4:12,d5:8,d6:5,d7:2,d8:1,wild:1,scatter:1,bonus:1})
    ];
    const REEL_STRIPS = REEL_STRIPS_NAMES.map(strip=>strip.map(symbolByName));

    /* Ø°ÙŠÙˆÙ„ Ø§Ù„Ø­Ø±ÙƒØ© */
    const RNG_WEIGHTS_TAIL={d1:180,d2:160,d3:140,d4:120,d5:100,d6:80,d7:60,d8:50,wild:1,scatter:1,bonus:1};
    const weightArray=symbolsArr.map(s=>RNG_WEIGHTS_TAIL[s.name]||1);
    const totalWeight=weightArray.reduce((a,b)=>a+b,0);
    function pickWeightedSymbol(){
      let r=Math.random()*totalWeight;
      for(let i=0;i<symbolsArr.length;i++){ r-=weightArray[i]; if(r<=0) return symbolsArr[i]; }
      return symbolsArr[symbolsArr.length-1];
    }

    const MAX_WIN_MULTIPLIER=3;
    const FREE_SPINS_COUNT=3;

    /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
    const linesCountSelect = document.getElementById("linesCount");
    const betPerLineInput  = document.getElementById("betPerLine");
    const creditsSpan      = document.getElementById("credits");
    const lastWinSpan      = document.getElementById("lastWin");
    const spinBtn          = document.getElementById("spinBtn");

    const reelsCount=5, rowsCount=3;
    const payLines=[
      [0,0,0,0,0],[1,1,1,1,1],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],
      [0,0,1,2,2],[2,2,1,0,0],[1,0,0,0,1],[1,2,2,2,1],[1,0,1,2,1]
    ];

    function getActivePayLinesCount(){
      const n = clamp(toInt(linesCountSelect.value,1),1,payLines.length);
      if(linesCountSelect.value!==String(n)) linesCountSelect.value=String(n); return n;
    }
    function getBetPerLine(){
      let n = toInt(betPerLineInput.value,1);
      if(!Number.isFinite(n) || n<1) n=1;
      if(String(n)!==betPerLineInput.value) betPerLineInput.value=String(n);
      return n;
    }
    betPerLineInput.addEventListener('input', ()=>{ betPerLineInput.value=String(Math.max(1,toInt(betPerLineInput.value,1))); });
    betPerLineInput.addEventListener('blur',  ()=>{ betPerLineInput.value=String(Math.max(1,toInt(betPerLineInput.value,1))); });
    linesCountSelect.addEventListener('change',()=>{ linesCountSelect.value=String(getActivePayLinesCount()); });

    let credits=1000, lastWin=0, isSpinning=false;
    function updateHUD(){
      credits=Math.max(0,Math.floor(fixNumber(credits,0)));
      lastWin=Math.max(0,Math.floor(fixNumber(lastWin,0)));
      creditsSpan.textContent=String(credits);
      lastWinSpan.textContent=String(lastWin);
    }

    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨ÙˆÙ†Øµ */
    function showBonusMessage(text){
      const overlay=document.createElement("div");
      overlay.style.cssText="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;justify-content:center;align-items:center;z-index:99999";
      const msg=document.createElement("div");
      msg.style.cssText="background:#ffdd00;color:#000;font-weight:bold;padding:1.4rem 2rem;border-radius:1rem;box-shadow:0 0 15px rgba(255,255,255,.8);font-size:clamp(18px,3.4vmin,26px)";
      msg.textContent=text; overlay.appendChild(msg); document.body.appendChild(overlay);
      setTimeout(()=>document.body.removeChild(overlay),2000);
    }

    /* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙƒØ±Ø§Øª */
    function createReelsLayout(){
      const reelsWrapper=document.getElementById("reels"); reelsWrapper.innerHTML="";
      for(let c=0;c<reelsCount;c++){const reel=document.createElement("div");reel.className="reel";reelsWrapper.appendChild(reel);}
    }

    /* ØªÙˆÙ„ÙŠØ¯ Ù†ØªÙŠØ¬Ø© */
    function generateSpinResult(){
      const res=[[],[],[]];
      for(let c=0;c<reelsCount;c++){
        const strip=REEL_STRIPS[c], len=strip.length, start=Math.floor(Math.random()*len);
        res[0][c]=strip[start]; res[1][c]=strip[(start+1)%len]; res[2][c]=strip[(start+2)%len];
      } return res;
    }

    /* Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ù„Ø§Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ (px) Ù…Ù† CSS */
    function TILE(){ return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--tile')) || 200; }

    /* Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙƒØ±Ø§Øª */
    const reelDurations=[0.60,0.70,0.80,0.90,1.00];
    const TAIL_BEFORE=12, TAIL_AFTER=10;
    let spinFinalResult=[];

    function buildReelSymbolsArray(reelIndex){
      const arr=[];
      for(let i=0;i<TAIL_BEFORE;i++) arr.push(pickWeightedSymbol());
      for(let r=0;r<rowsCount;r++) arr.push(spinFinalResult[r][reelIndex]);
      for(let j=0;j<TAIL_AFTER;j++) arr.push(pickWeightedSymbol());
      return arr;
    }

    function renderReelsStatic(){
      const reelDivs=document.querySelectorAll(".reel");
      for(let c=0;c<reelsCount;c++){
        const inner=document.createElement("div"); inner.className="reel-inner";
        const reelSymbols=buildReelSymbolsArray(c);
        inner.style.height=(reelSymbols.length * TILE())+"px";
        reelSymbols.forEach((sym,idx)=>{
          const d=document.createElement("div"); d.className="symbol"; d.style.top=(idx * TILE())+"px";
          const img=document.createElement("div"); img.className="symbol-img"; img.style.backgroundImage=getSymbolBackground(sym.url);
          d.appendChild(img); inner.appendChild(d);
        });
        reelDivs[c].appendChild(inner);
      }
    }

    function displaySpinWithAnimation(){
      const reelDivs=document.querySelectorAll(".reel"); let finished=0;
      ddSound.currentTime=0; ddSound.play().catch(()=>{});
      for(let c=0;c<reelsCount;c++){
        const inner=document.createElement("div"); inner.className="reel-inner";
        const arr=buildReelSymbolsArray(c); inner.style.height=(arr.length * TILE())+"px";
        arr.forEach((sym,idx)=>{
          const d=document.createElement("div"); d.className="symbol"; d.style.top=(idx * TILE())+"px";
          const img=document.createElement("div"); img.className="symbol-img"; img.style.backgroundImage=getSymbolBackground(sym.url);
          d.appendChild(img); inner.appendChild(d);
        });
        const old=reelDivs[c].querySelector(".reel-inner"); reelDivs[c].appendChild(inner); if(old) reelDivs[c].removeChild(old);
        inner.style.animation=`spinDown ${reelDurations[c]}s forwards linear`;
        inner.addEventListener("animationend", ()=>{finished++; if(finished===reelsCount) finalizeSpin();},{once:true});
      }
    }

    /* Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ÙÙˆØ² */
    function highlightWinningSymbols(lineIndex,count){
      const pattern=payLines[clamp(lineIndex,0,payLines.length-1)];
      const reelDivs=document.querySelectorAll(".reel");
      for(let c=0;c<count;c++){
        const rowIndex=pattern[c], symIndex=TAIL_BEFORE+rowIndex; // Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ 12..14
        const inner=reelDivs[c].querySelector(".reel-inner");
        if(inner){ const symDiv=inner.children[symIndex]; if(symDiv){ const img=symDiv.querySelector(".symbol-img"); if(img) img.classList.add("win-flash");}}
      }
    }
    function countSymbolInAll(spinResult,name){
      let cnt=0; for(let r=0;r<rowsCount;r++){for(let c=0;c<reelsCount;c++){if(spinResult[r][c].name===name) cnt++;}} return cnt;
    }

    /* Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) */
    function calculateLineWin(lineSyms,betVal){
      const payTable={
        "d1":[0,0,2,3,4],"d2":[0,0,2,3,5],"d3":[0,0,3,4,6],"d4":[0,0,3,5,7],
        "d5":[0,0,3,5,9],"d6":[0,0,3,6,11],"d7":[0,0,4,8,12],"d8":[0,0,5,9,14],
        "wild":[0,0,0,0,0],"scatter":[0,0,0,0,0],"bonus":[0,0,0,0,0]
      };
      let base=null,count=0;
      for(let i=0;i<lineSyms.length;i++){
        const n=lineSyms[i].name;
        if(i===0){ if(n!=="wild") base=n; count=1; }
        else{
          if(n===base || n==="wild") count++;
          else if(base===null && n!=="wild"){ base=n; count=1; }
          else break;
        }
      }
      let amt=0;
      if(base && payTable[base] && count>=3){ if(count>5) count=5; amt=payTable[base][count]*betVal; }
      return {amount:amt, count};
    }

    function evaluateWin(spinResult){
      let total=0; const linesActive=getActivePayLinesCount(); const betVal=getBetPerLine(); const totalBet=linesActive*betVal;

      for(let i=0;i<linesActive;i++){
        const pattern=payLines[i], line=[]; for(let c=0;c<reelsCount;c++){ line.push(spinResult[pattern[c]][c]); }
        const w=calculateLineWin(line,betVal); total+=w.amount; if(w.count>=3) highlightWinningSymbols(i,w.count);
      }

      const sc=countSymbolInAll(spinResult,"scatter"); if(sc>=3){ const t={3:1,4:2,5:4}; total+=(t[sc]||4)*betVal; }
      const bn=countSymbolInAll(spinResult,"bonus"); if(bn>=3){
        total+=(bn*5)*betVal; bonusSound.currentTime=0; bonusSound.play().catch(()=>{});
        freeSpins=FREE_SPINS_COUNT; isBonusActive=true;
        musicSound.pause(); musicSound.currentTime=0; crashSound.currentTime=0; crashSound.play().catch(()=>{});
        showBonusMessage(`ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${FREE_SPINS_COUNT} Ø¯ÙˆØ±Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©!`);
      }
      const cap=MAX_WIN_MULTIPLIER*totalBet; if(total>cap) total=cap;
      return total;
    }

    /* Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„ÙØ© */
    let lastDeductedBet=0;
    function finalizeSpin(){
      ddSound.pause(); ddSound.currentTime=0;

      const winAmount=Math.max(0,Math.floor(fixNumber(evaluateWin(spinFinalResult),0)));
      lastWin=winAmount; credits=fixNumber(credits,0)+winAmount;

      if(winAmount>0 && lastDeductedBet>0){
        credits+=lastDeductedBet; lastDeductedBet=0;
        winSound.currentTime=0; winSound.play().catch(()=>{});
      }

      updateHUD(); isSpinning=false;

      if(isBonusActive){
        if(freeSpins>0){ setTimeout(()=>{freeSpins--; doSpin();},300); }
        else{
          isBonusActive=false; crashSound.pause(); crashSound.currentTime=0; musicSound.currentTime=0; musicSound.play().catch(()=>{});
          spinBtn.disabled=false;
        }
      }else{ spinBtn.disabled=false; }
    }

    /* Ø¯ÙˆØ±Ø§Ù† Ø¬Ø¯ÙŠØ¯ */
    function doSpin(){
      if(isSpinning) return;

      credits=fixNumber(credits,0);
      lastDeductedBet=0;

      if(!isBonusActive || freeSpins<=0){
        const lines=getActivePayLinesCount();
        const betVal=getBetPerLine();
        const totalBet=lines*betVal;

        if(!Number.isFinite(totalBet) || totalBet<=0){ alert("Bet value is invalid."); return; }
        if(totalBet>credits){ alert("Insufficient credits!"); return; }

        credits-=totalBet; lastDeductedBet=totalBet; updateHUD();
      }

      isSpinning=true; spinBtn.disabled=true;
      spinSound.currentTime=0; spinSound.play().catch(()=>{});

      spinFinalResult=generateSpinResult();
      displaySpinWithAnimation();
    }
    spinBtn.addEventListener("click", ()=>{ if(isBonusActive&&freeSpins>0) return; doSpin(); });

    /* ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© + Ø±Ø³Ù… Ø³Ø§ÙƒÙ† */
    window.addEventListener("load", ()=>{
      createReelsLayout();
      spinFinalResult=generateSpinResult();
      renderReelsStatic();
      updateHUD();
    });

    /* ===== ØªØ­Ø¬ÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø© --tile Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø¯ÙˆÙ† Ù‚Øµ ===== */
    (function fitGameToViewport(){
      const root=document.documentElement;

      function setTile(px){ root.style.setProperty('--tile', Math.max(40, px) + 'px'); }

      function recalc(){
        const vw = Math.max(1, window.innerWidth || document.documentElement.clientWidth || 0);
        const vh = Math.max(1, (window.visualViewport ? visualViewport.height : window.innerHeight) || window.innerHeight);

        const horizontalPad = Math.max(8, vw * 0.04);   // Ù‡Ø§Ù…Ø´ Ø¬Ø§Ù†Ø¨ÙŠ
        const maxTileByW = (vw - horizontalPad*2) / 5;

        // ØªØ¬Ø±ÙŠØ¨ÙŠÙ‹Ø§ Ù†Ø¹ÙŠÙ†Ù‡Ø§ Ù„Ø­Ø³Ø§Ø¨ Ø§Ø±ØªÙØ§Ø¹ ØµÙ Ø§Ù„Ø³Ø¨Ù†
        setTile(maxTileByW);
        const spinRow = document.querySelector('.spin-row');
        const spinH = spinRow ? spinRow.getBoundingClientRect().height : 0;
        const verticalMargins = Math.max(12, vh * 0.03);

        const maxTileByH = (vh - spinH - verticalMargins*2) / 3;

        const tile = Math.min(maxTileByW, maxTileByH);
        setTile(tile);

        // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø­Ø±ÙƒØ© Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ù†Ø¹ÙŠØ¯ Ø±Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø§ÙƒÙ† Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù…
        if(!isSpinning){
          const reels = document.getElementById('reels');
          if(reels && reels.children.length){
            createReelsLayout();
            renderReelsStatic();
          }
        }
      }

      window.addEventListener('load', recalc);
      window.addEventListener('resize', recalc);
      window.addEventListener('orientationchange', recalc);
      if(window.visualViewport) visualViewport.addEventListener('resize', recalc);
    })();

    /* ===== Ø¥Ù† ÙˆÙØ¬Ø¯ Canvas: Ø§Ø¬Ø¹Ù„Ù‡ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆÙŠÙØ¹Ø§Ø¯ Ø­Ø¬Ù…Ù‡ Ù…Ø¹ Ø§Ù„ØªØºÙŠÙŠØ± ===== */
    (function autoFitCanvas(){
      const canvases = Array.from(document.querySelectorAll('canvas[data-autofit="true"], canvas.autofit, canvas#gameCanvas'));
      if (!canvases.length) return;
      function sizeAll(){
        canvases.forEach(cv=>{
          cv.width  = window.innerWidth;
          cv.height = window.innerHeight;
          cv.style.width  = '100vw';
          cv.style.height = '100vh';
          cv.style.display = 'block';
        });
      }
      window.addEventListener('load', sizeAll);
      window.addEventListener('resize', sizeAll);
      window.addEventListener('orientationchange', sizeAll);
    })();

    /* RNG Ø¢Ù…Ù† (ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©) */
    function rand(){
      const cryptoObj=(window.crypto||window.msCrypto);
      if(cryptoObj&&cryptoObj.getRandomValues){const a=new Uint32Array(1);cryptoObj.getRandomValues(a);return a[0]/4294967296;}
      return Math.random();
    }
  </script>
</body>
</html>
